<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset='utf-8' />
    <title>Store Locator</title>
    <meta name='robots' content='noindex, nofollow'>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700' rel='stylesheet'>
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.6.1/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.6.1/mapbox-gl.css' rel='stylesheet' />
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.2.0/mapbox-gl-geocoder.min.js'></script>
    <link rel='stylesheet'
          href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.2.0/mapbox-gl-geocoder.css'
          type='text/css'/>
    <style>
        @import url('https://fonts.googleapis.com/css?family=Josefin+Sans&display=swap');

        body {
            color:#404040;
            font-family: 'Josefin Sans',serif;
            margin:0;
            padding:0;
            -webkit-font-smoothing:antialiased;
        }

        * {
            -webkit-box-sizing:border-box;
            -moz-box-sizing:border-box;
            box-sizing:border-box;
        }

        .sidebar {
            position:absolute;
            width:33.3333%;
            height:100%;
            top:0;left:0;
            overflow:hidden;
            border-right:1px solid rgba(0,0,0,0.25);
        }


        .map {
            position:absolute;
            left:33.3333%;
            width:66.6666%;
            top:0;bottom:0;
        }

        h1 {
            font-size:25px;
            margin:0;
            font-weight:400;
            line-height: 20px;
            padding: 20px 2px;
        }



        .heading {
            background:#fff;
            border-bottom:1px solid #eee;
            min-height:60px;
            line-height:60px;
            padding:0 10px;
            background-color: black;
            color: #fff;
        }
        .sub-heading {
            font-size:25px;
            margin: 10px ;
        }


        .quest input[type="text"], .quest input[type="date"], .quest input[type="time"], .quest select{
            width: 95%;
            display: block;
            margin: 10px auto;
            padding: 15px;
            border: 1px solid #b5b5b5;
            outline: none;
        }

        .quest button{
            max-width: 150px;
            width: 100%;
            background: #444444;
            color: #f9f9f9;
            border: none;
            padding: 10px;
            text-transform: uppercase;
            border-radius: 2px;
            float:left;
            cursor:pointer;
            margin:10px 0 0 20px;
        }

        .map {
            position:absolute;
            left:33.3333%;
            width:66.6666%;
            top:0;bottom:0;
        }


    </style>
</head>
<body>
<div class='sidebar'>
    <div class='heading'>
        <h1>QuestLog - Quests</h1>
    </div>
    <div id='listings' class='listings'>
        <form th:action="@{/quests/add}" th:object="${quest}"method="POST"  class="quest">
            <div class="sub-heading">NEW QUEST</div>
            <hr style="width: 95%;">
            <input type="text" id="name" name="name"  placeholder="QUEST NAME" th:field="*{name}"/>
            <input type="text" id="desc" name="desc"  placeholder="QUEST DESCRIPTION" th:field="*{description}"/>
            <input type="text" placeholder="QUEST DEADLINE"
                   onfocus="(this.type='date')"
                   onblur="(this.type='text')" id="date" name="date" th:field="*{deadline}"/>
            <input type="text" placeholder="QUEST TIME"
                   onfocus="(this.type='time')"
                   onblur="(this.type='text')" id="time" name="date" th:field="*{time}"/>
            <select id="type"  th:field="*{questType}">
                <option th:each="type: ${T(com.lankovv.questlog.model.QuestType).values()}" th:value="${type}"
                        th:text="${(type.name).toUpperCase()}"></option>
            </select>
            <input type="hidden" th:field="${quest.localization.longitude}" id="longitude" value=""/>
            <input type="hidden" th:field="${quest.localization.latitude}" id="latitude" value=""/>
            <input type="hidden" th:field="${quest.localization.address}" id="address" value=""/>
            <button name="Submit" type="Submit"
                    th:text="Create"></button>

        </form>
    </div>
    </div>
</div>
<div id='map' class='map'></div>
<script>
    mapboxgl.accessToken = 'pk.eyJ1IjoibGFua292diIsImEiOiJjazBhdmJidDMwbHhvM2dud3d0b3BwajY0In0.vBvnDXH2rc02S-JQnpL1bQ';
    var map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/light-v10',
        center: [14.560, 53.428],
        zoom: 11
    });


    var geocoder = new MapboxGeocoder({ // Initialize the geocoder
        accessToken: mapboxgl.accessToken, // Set the access token
        mapboxgl: mapboxgl, // Set the mapbox-gl instance
        marker: {
            color: 'black',
            // draggable: true
        },
        placeholder: 'Search for quest localizations', // Placeholder text for the search bar
        // bbox: [14, 53, 15, 54], // Boundary for Western Voidvodeship
        proximity: {
            longitude: 14.560,
            coords: 53.428
        } // Coordinates of Szczecin
    });

    // Add the geocoder to the map
    map.addControl(geocoder);


    map.on('load', function () {
        map.addSource('single-point', {
            type: 'geojson',
            data: {
                type: 'FeatureCollection',
                features: []
            }
        });

        // Listen for the `result` event from the Geocoder
        // `result` event is triggered when a user makes a selection
        // Add a marker at the result's coordinates
        geocoder.on('result', function (ev) {
            map.getSource('single-point').setData(ev.result.geometry);
            console.log(ev.result.place_name);
            document.getElementById('longitude').value = ev.result.center[0];
            document.getElementById('latitude').value = ev.result.center[1];
            document.getElementById('address').value = ev.result.place_name;

        });

    });

</script>
</body>
</html>